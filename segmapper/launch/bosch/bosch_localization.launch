<?xml version="1.0" encoding="utf-8"?>

<launch>
  
  <arg name="respawn_value" default="false" /> <!-- boolean: true, false -->
  
  <!-- Bag file path -->  
  <arg name="bag_file" value="$(env HOME)/.segmap/bosch/augmented_bosch1.bag"/>
	
  <!-- Rviz visualization config file path -->
  <arg name="rviz_config_file" value="$(env HOME)/.segmap/kitti/kitti_loop_closure.rviz"/>

  <!-- ROS parameters -->
  <rosparam>use_sim_time: true</rosparam>

  <rosparam command="load" file="$(find segmapper)/launch/bosch/bosch_localization.yaml"/>
  
  <!-- Target cloud -->
  <arg name="target_cloud" value="/tmp/map.pcd"/>
  <rosparam param="/SegMapper/SegMatchWorker/target_cloud_filename" subst_value="True">$(arg target_cloud)</rosparam>
  
  <!-- Callgrind profiling option -->
  <arg name="enable_callgrind" default="false" />
  <arg name="play_rate" value="0.005" if="$(arg enable_callgrind)"/>
  <arg name="play_rate" value="1" unless="$(arg enable_callgrind)"/>

  <!-- rviz node -->
  <node name="visualizer" pkg="rviz" type="rviz" output="screen" respawn="$(arg respawn_value)" args="-d $(arg rviz_config_file)" />
  
  <!-- segmapper node -->
  <include file="$(find segmapper)/launch/segmapper.launch">
    <arg name="icp_configuration_file" value="$(find segmapper)/launch/bosch/icp_dynamic_outdoor.yaml"/>
    <arg name="icp_input_filters_file" value="$(find segmapper)/launch/bosch/input_filters_outdoor.yaml"/>
    <arg name="enable_callgrind" value="$(arg enable_callgrind)"/>
  </include>

    <!-- rosbag player node -->
  <node name="player" pkg="rosbag" type="play" output="screen" args=" -r 1 -s 0 --clock --quiet --pause $(arg bag_file)"/>

  <!-- Tensorflow interface -->
  <!-- <node pkg="segmatch" name="tf_cnn_interface" type="tf_cnn_interface.py" output="screen">
  </node> -->
  <!-- <node pkg="segmatch" name="tf_sem_interface" type="tf_sem_interface.py" output="screen">
  </node> -->

  <node pkg="noiser" name="noiser" type="noiser" output="screen">
  <rosparam command="load" file="$(find noiser)/config/noiser_config.yaml"/>
  </node>
	
</launch>
